<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Naming Workflow - AI-Powered Naming Strategy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="max-w-7xl mx-auto p-6 min-h-screen">
        <!-- Loading State -->
        <div id="loading" class="text-center py-20">
            <div class="animate-spin h-12 w-12 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"></div>
            <p class="text-gray-600">Loading Company Naming Workflow...</p>
        </div>

        <!-- Business Form -->
        <div id="businessForm" class="hidden">
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h1 class="text-2xl font-bold text-gray-900 mb-2">AI Company Naming Workflow</h1>
                            <p class="text-gray-600">Generate comprehensive naming strategies with real AI integrations</p>
                        </div>
                        <div id="apiStatus" class="px-3 py-2 rounded-lg text-sm bg-yellow-50 text-yellow-700 border border-yellow-200">
                            <span>‚è≥ Connecting to API...</span>
                        </div>
                    </div>
                </div>
                
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Industry/Sector *</label>
                            <input type="text" id="industry" placeholder="e.g., Commercial Real Estate Appraisal" 
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Service Specialization *</label>
                            <input type="text" id="serviceSpecialization" placeholder="e.g., Multifamily and Self-Storage Properties"
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Geographic Market *</label>
                            <input type="text" id="geographicMarket" placeholder="e.g., Western Canada - Alberta, BC, Saskatchewan, Manitoba"
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Business Type *</label>
                            <input type="text" id="businessType" placeholder="e.g., Professional Services Firm"
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Target Clients</label>
                            <input type="text" id="targetClients" placeholder="e.g., Property investors, developers, lenders"
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Professional Certifications</label>
                            <input type="text" id="certifications" placeholder="e.g., AACI, CRA, 15+ years experience"
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Key Differentiators</label>
                            <textarea id="keyDifferentiators" rows="3" placeholder="e.g., AACI Certified, 15+ years experience, specialized in complex valuations"
                                      class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Value Proposition</label>
                            <textarea id="valueProp" rows="3" placeholder="e.g., Fast turnaround, accurate valuations, comprehensive market analysis"
                                      class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                    </div>
                    
                    <div class="mt-6 flex gap-4">
                        <button onclick="startWorkflow()" id="startBtn" disabled
                                class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium disabled:opacity-50">
                            üöÄ Start AI Naming Workflow
                        </button>
                        <button onclick="loadExampleData()"
                                class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 font-medium">
                            üìù Load Example Data
                        </button>
                        <button onclick="checkAPIHealth()"
                                class="px-6 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 font-medium">
                            üîç Test Connection
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Workflow Dashboard -->
        <div id="workflowDashboard" class="hidden">
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h1 class="text-2xl font-bold text-gray-900 mb-2">AI Naming Workflow Dashboard</h1>
                            <p class="text-gray-600">9-step AI process with Perplexity, ChatGPT, and Claude Sonnet</p>
                        </div>
                        <div id="dashboardApiStatus" class="px-3 py-2 rounded-lg text-sm bg-green-50 text-green-700 border border-green-200">
                            <span>‚úÖ Live API Connected</span>
                        </div>
                    </div>
                    
                    <div class="flex gap-4">
                        <button onclick="executeCurrentStep()" id="executeBtn"
                                class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            ‚ñ∂Ô∏è Execute Current Step
                        </button>
                        <button onclick="runFullWorkflow()" id="fullWorkflowBtn"
                                class="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                            üöÄ Run Complete Workflow
                        </button>
                        <button onclick="backToForm()"
                                class="flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                            ‚¨ÖÔ∏è Edit Business Data
                        </button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Steps Sidebar -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                        <h2 class="text-lg font-semibold mb-4">Workflow Steps</h2>
                        <div id="stepsList" class="space-y-2">
                            <!-- Steps will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="p-4 border-b border-gray-200">
                            <div id="currentStepHeader">
                                <h3 class="text-lg font-semibold">Step 1: Market & SEO Research</h3>
                                <span class="inline-block px-3 py-1 rounded-full text-sm font-medium mt-2 bg-blue-100 text-blue-800 border border-blue-200">
                                    Perplexity
                                </span>
                            </div>
                        </div>

                        <div class="p-4">
                            <div id="stepContent">
                                <div>
                                    <h4 class="font-medium text-gray-900 mb-2">Ready to Execute:</h4>
                                    <div class="bg-gray-50 p-3 rounded-lg border">
                                        <p class="text-sm text-gray-700">Click "Execute Current Step" to start AI processing with real LLM integrations.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Messages -->
        <div id="statusMessage" class="hidden mt-6 p-4 rounded-lg">
            <div class="flex items-center gap-2">
                <span id="statusIcon">‚úÖ</span>
                <span id="statusText">Status message</span>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_URLS = [
            'https://company-naming-workflow-backend.onrender.com/api/workflow',
            'https://company-naming-workflow-backend.up.railway.app/api/workflow',
            'https://company-naming-workflow-backend.vercel.app/api/workflow',
            'http://localhost:3001/api/workflow'
        ];
        
        let currentAPIURL = '';
        let currentStep = 0;
        let stepOutputs = {};
        let workflowSteps = [];
        let businessData = {};
        let isRunning = false;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Company Naming Workflow Loading...');
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('businessForm').classList.remove('hidden');
                findWorkingAPI();
            }, 1000);
        });

        // Find working API endpoint
        async function findWorkingAPI() {
            updateStatus('‚è≥ Finding live API endpoint...', 'info');
            
            for (const url of API_URLS) {
                try {
                    console.log(`Testing API: ${url}`);
                    const response = await fetch(`${url}/health`, { 
                        method: 'GET',
                        headers: { 'Content-Type': 'application/json' }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        if (data.status === 'healthy') {
                            currentAPIURL = url;
                            updateAPIStatus('‚úÖ Live API Connected', 'success');
                            updateStatus(`‚úÖ Connected to: ${url.replace('http://localhost:3001/api/workflow', 'Local Development').replace('https://company-naming-workflow-backend.onrender.com/api/workflow', 'Render Deployment').replace('https://company-naming-workflow-backend.up.railway.app/api/workflow', 'Railway Deployment').replace('https://company-naming-workflow-backend.vercel.app/api/workflow', 'Vercel Deployment')}`, 'success');
                            document.getElementById('startBtn').disabled = false;
                            await loadWorkflowSteps();
                            return;
                        }
                    }
                } catch (error) {
                    console.log(`API ${url} not available:`, error.message);
                }
            }
            
            updateAPIStatus('‚ùå API Unavailable', 'error');
            updateStatus('‚ùå No live API found. Please deploy the backend first.', 'error');
        }

        // Update API status indicator
        function updateAPIStatus(text, type) {
            const statusEl = document.getElementById('apiStatus');
            const dashboardStatusEl = document.getElementById('dashboardApiStatus');
            
            const classes = {
                success: 'bg-green-50 text-green-700 border-green-200',
                error: 'bg-red-50 text-red-700 border-red-200',
                info: 'bg-yellow-50 text-yellow-700 border-yellow-200'
            };
            
            statusEl.className = `px-3 py-2 rounded-lg text-sm border ${classes[type]}`;
            statusEl.innerHTML = `<span>${text}</span>`;
            
            if (dashboardStatusEl) {
                dashboardStatusEl.className = `px-3 py-2 rounded-lg text-sm border ${classes[type]}`;
                dashboardStatusEl.innerHTML = `<span>${text}</span>`;
            }
        }

        // Update status message
        function updateStatus(text, type = 'info') {
            const messageEl = document.getElementById('statusMessage');
            const iconEl = document.getElementById('statusIcon');
            const textEl = document.getElementById('statusText');
            
            const icons = { success: '‚úÖ', error: '‚ùå', info: '‚ÑπÔ∏è' };
            const classes = {
                success: 'bg-green-50 border border-green-200 text-green-700',
                error: 'bg-red-50 border border-red-200 text-red-700',
                info: 'bg-blue-50 border border-blue-200 text-blue-700'
            };
            
            iconEl.textContent = icons[type];
            textEl.textContent = text;
            messageEl.className = `mt-6 p-4 rounded-lg ${classes[type]}`;
            messageEl.classList.remove('hidden');
            
            console.log(`${icons[type]} ${text}`);
        }

        // Load workflow steps from API
        async function loadWorkflowSteps() {
            try {
                const response = await fetch(`${currentAPIURL}/steps`);
                if (!response.ok) throw new Error('Failed to load steps');
                
                const data = await response.json();
                workflowSteps = data.steps;
                console.log('‚úÖ Loaded workflow steps:', workflowSteps.length);
                populateSteps();
            } catch (error) {
                console.error('Error loading steps:', error);
                updateStatus('‚ö†Ô∏è Using default workflow steps', 'info');
                workflowSteps = getDefaultSteps();
                populateSteps();
            }
        }

        // Get default workflow steps
        function getDefaultSteps() {
            return [
                { id: 1, title: "Market & SEO Research", llm: "Perplexity", color: "bg-blue-500" },
                { id: 2, title: "Keyword Expansion", llm: "Claude Sonnet", color: "bg-orange-500" },
                { id: 3, title: "Gap Analysis", llm: "Claude Sonnet", color: "bg-orange-500" },
                { id: 4, title: "Search Intent Mapping", llm: "Claude Sonnet", color: "bg-orange-500" },
                { id: 5, title: "Name Generation", llm: "Claude Sonnet", color: "bg-orange-500" },
                { id: 6, title: "Tagline Development", llm: "ChatGPT", color: "bg-green-500" },
                { id: 7, title: "Multi-Criteria Assessment", llm: "Claude Sonnet", color: "bg-orange-500" },
                { id: 8, title: "Market Validation", llm: "Perplexity", color: "bg-blue-500" },
                { id: 9, title: "Final Strategic Report", llm: "Claude Sonnet", color: "bg-orange-500" }
            ];
        }

        // Populate steps in sidebar
        function populateSteps() {
            const stepsList = document.getElementById('stepsList');
            stepsList.innerHTML = '';
            
            workflowSteps.forEach((step, index) => {
                const stepEl = document.createElement('div');
                stepEl.className = `p-3 rounded-lg cursor-pointer border-2 transition-all ${
                    currentStep === index ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'
                }`;
                stepEl.onclick = () => setCurrentStep(index);
                
                const llmColors = {
                    'Perplexity': 'bg-blue-100 text-blue-800 border-blue-200',
                    'Claude Sonnet': 'bg-orange-100 text-orange-800 border-orange-200',
                    'ChatGPT': 'bg-green-100 text-green-800 border-green-200'
                };
                
                stepEl.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium">Step ${step.id}</span>
                        <div class="flex items-center gap-2">
                            <span class="px-2 py-1 rounded-full text-xs font-medium border ${llmColors[step.llm]}">
                                ${step.llm}
                            </span>
                            ${stepOutputs[`STEP_${step.id}_OUTPUT`] ? '<div class="w-2 h-2 bg-green-500 rounded-full"></div>' : ''}
                        </div>
                    </div>
                    <p class="text-sm text-gray-600 font-medium">${step.title}</p>
                `;
                
                stepsList.appendChild(stepEl);
            });
        }

        // Set current step
        function setCurrentStep(index) {
            currentStep = index;
            populateSteps();
            updateCurrentStepHeader();
        }

        // Update current step header
        function updateCurrentStepHeader() {
            const step = workflowSteps[currentStep];
            if (!step) return;
            
            const llmColors = {
                'Perplexity': 'bg-blue-100 text-blue-800 border-blue-200',
                'Claude Sonnet': 'bg-orange-100 text-orange-800 border-orange-200',
                'ChatGPT': 'bg-green-100 text-green-800 border-green-200'
            };
            
            document.getElementById('currentStepHeader').innerHTML = `
                <h3 class="text-lg font-semibold">Step ${step.id}: ${step.title}</h3>
                <span class="inline-block px-3 py-1 rounded-full text-sm font-medium mt-2 border ${llmColors[step.llm]}">
                    ${step.llm}
                </span>
            `;
        }

        // Load example data
        function loadExampleData() {
            document.getElementById('industry').value = 'Commercial Real Estate Appraisal';
            document.getElementById('serviceSpecialization').value = 'Multifamily and Self-Storage Properties';
            document.getElementById('geographicMarket').value = 'Western Canada - Alberta, BC, Saskatchewan, Manitoba';
            document.getElementById('businessType').value = 'Professional Services Firm';
            document.getElementById('targetClients').value = 'Property investors, developers, lenders';
            document.getElementById('certifications').value = 'AACI, CRA';
            document.getElementById('keyDifferentiators').value = 'AACI Certified, 15+ years experience, specialized in complex valuations';
            document.getElementById('valueProp').value = 'Fast turnaround, accurate valuations, comprehensive market analysis';
            
            updateStatus('‚úÖ Example business data loaded!', 'success');
        }

        // Check API health
        async function checkAPIHealth() {
            updateStatus('üîç Testing API connection...', 'info');
            await findWorkingAPI();
        }

        // Collect business data
        function collectBusinessData() {
            return {
                industry: document.getElementById('industry').value,
                serviceSpecialization: document.getElementById('serviceSpecialization').value,
                geographicMarket: document.getElementById('geographicMarket').value,
                businessType: document.getElementById('businessType').value,
                targetClients: document.getElementById('targetClients').value,
                certifications: document.getElementById('certifications').value,
                keyDifferentiators: document.getElementById('keyDifferentiators').value,
                valueProp: document.getElementById('valueProp').value,
                companySize: 'Small firm'
            };
        }

        // Start workflow
        async function startWorkflow() {
            businessData = collectBusinessData();
            
            // Validate required fields
            const required = ['industry', 'serviceSpecialization', 'geographicMarket', 'businessType'];
            const missing = required.filter(field => !businessData[field].trim());
            
            if (missing.length > 0) {
                updateStatus(`‚ùå Please fill required fields: ${missing.join(', ')}`, 'error');
                return;
            }
            
            if (!currentAPIURL) {
                updateStatus('‚ùå No API connection available', 'error');
                return;
            }
            
            // Switch to dashboard
            document.getElementById('businessForm').classList.add('hidden');
            document.getElementById('workflowDashboard').classList.remove('hidden');
            
            updateStatus('‚úÖ Ready to execute AI naming workflow!', 'success');
        }

        // Execute current step
        async function executeCurrentStep() {
            if (isRunning || !currentAPIURL) return;
            
            isRunning = true;
            const step = workflowSteps[currentStep];
            
            updateStatus(`ü§ñ Executing Step ${step.id} with ${step.llm}...`, 'info');
            
            // Update UI
            document.getElementById('executeBtn').innerHTML = '‚è≥ Processing...';
            document.getElementById('executeBtn').disabled = true;
            
            try {
                const requestBody = {
                    stepId: step.id,
                    businessData,
                    stepOutputs
                };
                
                const startTime = Date.now();
                const response = await fetch(`${currentAPIURL}/execute-step`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `HTTP ${response.status}`);
                }
                
                const result = await response.json();
                const executionTime = Date.now() - startTime;
                
                if (result.success) {
                    // Store outputs
                    stepOutputs[`STEP_${step.id}_OUTPUT`] = result.output;
                    
                    // Handle Step 1 sections
                    if (step.id === 1) {
                        const sectionAMatch = result.output.match(/\(A\)\s*([^(]*?)(?=\(B\)|$)/s);
                        const sectionBMatch = result.output.match(/\(B\)\s*(.*)/s);
                        
                        if (sectionAMatch) stepOutputs[`STEP_${step.id}_A`] = sectionAMatch[1].trim();
                        if (sectionBMatch) stepOutputs[`STEP_${step.id}_B`] = sectionBMatch[1].trim();
                    }
                    
                    // Update display
                    document.getElementById('stepContent').innerHTML = `
                        <div>
                            <h4 class="font-medium text-gray-900 mb-2">‚úÖ Step ${step.id} Complete!</h4>
                            <div class="bg-green-50 p-3 rounded-lg border border-green-200 max-h-96 overflow-y-auto">
                                <p class="text-sm text-gray-700 mb-2"><strong>${step.llm}</strong> generated ${result.output.length} characters in ${result.executionTime}ms</p>
                                <pre class="text-sm text-gray-700 whitespace-pre-wrap">${result.output}</pre>
                            </div>
                        </div>
                    `;
                    
                    populateSteps(); // Update step indicators
                    updateStatus(`‚úÖ Step ${step.id} completed! Generated ${result.output.length} characters with ${step.llm}`, 'success');
                    
                    // Auto-advance to next step
                    if (currentStep < workflowSteps.length - 1) {
                        setTimeout(() => {
                            setCurrentStep(currentStep + 1);
                            updateStatus(`‚û°Ô∏è Advanced to Step ${workflowSteps[currentStep].id}`, 'info');
                        }, 2000);
                    }
                    
                } else {
                    throw new Error(result.error || 'Step execution failed');
                }
                
            } catch (error) {
                console.error('Step execution error:', error);
                updateStatus(`‚ùå Step ${step.id} failed: ${error.message}`, 'error');
            } finally {
                isRunning = false;
                document.getElementById('executeBtn').innerHTML = '‚ñ∂Ô∏è Execute Current Step';
                document.getElementById('executeBtn').disabled = false;
            }
        }

        // Run full workflow
        async function runFullWorkflow() {
            if (isRunning || !currentAPIURL) return;
            
            updateStatus('üöÄ Starting complete 9-step AI workflow...', 'info');
            
            try {
                const requestBody = {
                    businessData,
                    startFromStep: 1,
                    endAtStep: workflowSteps.length
                };
                
                const response = await fetch(`${currentAPIURL}/execute-workflow`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'Failed to start workflow');
                }
                
                const result = await response.json();
                updateStatus(`üéØ Full workflow started! Execution ID: ${result.executionId}`, 'success');
                
                // Poll for results
                pollWorkflowStatus(result.executionId);
                
            } catch (error) {
                console.error('Full workflow error:', error);
                updateStatus(`‚ùå Full workflow failed: ${error.message}`, 'error');
            }
        }

        // Poll workflow status
        async function pollWorkflowStatus(executionId) {
            try {
                const response = await fetch(`${currentAPIURL}/execution/${executionId}`);
                if (!response.ok) throw new Error('Failed to get workflow status');
                
                const execution = await response.json();
                
                // Update current step
                setCurrentStep(execution.currentStep - 1);
                
                // Update outputs
                Object.entries(execution.results).forEach(([key, stepResult]) => {
                    if (stepResult.success) {
                        const stepId = parseInt(key.split('_')[1]);
                        stepOutputs[`STEP_${stepId}_OUTPUT`] = stepResult.output;
                        
                        if (stepId === 1) {
                            const sectionAMatch = stepResult.output.match(/\(A\)\s*([^(]*?)(?=\(B\)|$)/s);
                            const sectionBMatch = stepResult.output.match(/\(B\)\s*(.*)/s);
                            
                            if (sectionAMatch) stepOutputs[`STEP_${stepId}_A`] = sectionAMatch[1].trim();
                            if (sectionBMatch) stepOutputs[`STEP_${stepId}_B`] = sectionBMatch[1].trim();
                        }
                    }
                });
                
                populateSteps();
                
                if (execution.status === 'completed') {
                    updateStatus('üéâ Complete 9-step workflow finished! Full naming strategy generated.', 'success');
                    
                    // Show final results
                    document.getElementById('stepContent').innerHTML = `
                        <div>
                            <h4 class="font-medium text-gray-900 mb-2">üéâ Complete Workflow Finished!</h4>
                            <div class="bg-green-50 p-3 rounded-lg border border-green-200">
                                <p class="text-sm text-gray-700 mb-2">‚úÖ All 9 steps completed successfully</p>
                                <p class="text-sm text-gray-700 mb-2">‚úÖ Full naming strategy generated</p>
                                <p class="text-sm text-gray-700">‚úÖ Ready for client delivery</p>
                            </div>
                        </div>
                    `;
                } else if (execution.status === 'error') {
                    updateStatus(`‚ùå Workflow failed: ${execution.error}`, 'error');
                } else {
                    updateStatus(`‚è≥ Processing Step ${execution.currentStep}/${execution.totalSteps}...`, 'info');
                    setTimeout(() => pollWorkflowStatus(executionId), 3000);
                }
                
            } catch (error) {
                console.error('Polling error:', error);
                updateStatus(`‚ùå Status check failed: ${error.message}`, 'error');
            }
        }

        // Back to form
        function backToForm() {
            document.getElementById('workflowDashboard').classList.add('hidden');
            document.getElementById('businessForm').classList.remove('hidden');
            updateStatus('‚¨ÖÔ∏è Returned to business data form', 'info');
        }
    </script>
</body>
</html>